function [l1, l2, k, v1, v2, v3, u1, u2, u3] =  solver_H35lv1v2k_det_54x60(x1, xp1, x2, xp2, x3, xp3, x4, xp4)
data = [x1(1:2);xp1(1:2);x2(1:2);xp2(1:2);x3(1:2);xp3(1:2);x4(1:2);xp4(1:2)];
C = setup_elimination_template(data);
% C0 = C(:,1:54);
% C1 = C(:,55:end);
% C1 = C0 \ C1;
% RR = [-C1(end-2:end,:);eye(4)];
C = gj(C);
RR = [-C(end-3:end,end-5:end);eye(6)];
AM_ind = [9,1,2,3,10,4];
AM = RR(AM_ind,:);
[V,D] = eig(AM);
V = V ./ (ones(size(V,1),1)*V(1,:));
sols(1,:) = diag(D).';
sols(2,:) = V(2,:);
sols(3,:) = V(3,:);

I = find(abs(imag(sols(1,:)))<10e-6);

k = sols(1,I);
l1 = sols(2,I);
l2 = sols(3,I);

x11 = x1;
x1p1 = xp1;

x21 = x2;
x2p1 = xp2;


x31 = x3;
x3p1 = xp3;

x41 = x4;
x4p1 = xp4;

for i = 1:size(l1,2)
    
    M1 =  [- x11(2)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) - l1(i)*x11(2)*x1p1(1) - l2(i)*x11(2)*x1p1(2), x11(1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) + l1(i)*x11(1)*x1p1(1) + l2(i)*x11(1)*x1p1(2),                                                           0,                                          x11(1)*x1p1(2) - x11(2)*x1p1(1); ...
        - x21(2)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) - l1(i)*x21(2)*x2p1(1) - l2(i)*x21(2)*x2p1(2), x21(1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) + l1(i)*x21(1)*x2p1(1) + l2(i)*x21(1)*x2p1(2),                                                           0,                                          x21(1)*x2p1(2) - x21(2)*x2p1(1) ; ...
        (k(i)*(x11(1)^2 + x11(2)^2) + 1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) + l1(i)*x1p1(1)*(k(i)*(x11(1)^2 + x11(2)^2) + 1) + l2(i)*x1p1(2)*(k(i)*(x11(1)^2 + x11(2)^2) + 1),                                                         0, - x11(1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) - l1(i)*x11(1)*x1p1(1) - l2(i)*x11(1)*x1p1(2), x1p1(1)*(k(i)*(x11(1)^2 + x11(2)^2) + 1) - x11(1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) ; ...
        (k(i)*(x21(1)^2 + x21(2)^2) + 1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) + l1(i)*x2p1(1)*(k(i)*(x21(1)^2 + x21(2)^2) + 1) + l2(i)*x2p1(2)*(k(i)*(x21(1)^2 + x21(2)^2) + 1),                                                         0, - x21(1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) - l1(i)*x21(1)*x2p1(1) - l2(i)*x21(1)*x2p1(2), x2p1(1)*(k(i)*(x21(1)^2 + x21(2)^2) + 1) - x21(1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) ; ...
        l1(i),                                                        l2(i),                                                           1,                                                            0 ];
    
    [~,~,V] = svd(M1);
    
    v1(i) = V(1,end)/V(4,end);
    v2(i) = V(2,end)/V(4,end);
    v3(i) = V(3,end)/V(4,end);
    
    M2 = [- x31(2)*(k(i)*(x3p1(1)^2 + x3p1(2)^2) + 1) - l1(i)*x31(2)*x3p1(1) - l2(i)*x31(2)*x3p1(2),       x31(1)*(k(i)*(x3p1(1)^2 + x3p1(2)^2) + 1) + l1(i)*x31(1)*x3p1(1) + l2(i)*x31(1)*x3p1(2),                                                                 0,                                          x31(1)*x3p1(2) - x31(2)*x3p1(1); ...
         - x41(2)*(k(i)*(x4p1(1)^2 + x4p1(2)^2) + 1) - l1(i)*x41(2)*x4p1(1) - l2(i)*x41(2)*x4p1(2),       x41(1)*(k(i)*(x4p1(1)^2 + x4p1(2)^2) + 1) + l1(i)*x41(1)*x4p1(1) + l2(i)*x41(1)*x4p1(2),                                                                 0,                                          x41(1)*x4p1(2) - x41(2)*x4p1(1); ...
        (k(i)*(x31(1)^2 + x31(2)^2) + 1)*(k(i)*(x3p1(1)^2 + x3p1(2)^2) + 1) + l1(i)*x3p1(1)*(k(i)*(x31(1)^2 + x31(2)^2) + 1) + l2(i)*x3p1(2)*(k(i)*(x31(1)^2 + x31(2)^2) + 1),                                                               0,       - x31(1)*(k(i)*(x3p1(1)^2 + x3p1(2)^2) + 1) - l1(i)*x31(1)*x3p1(1) - l2(i)*x31(1)*x3p1(2), x3p1(1)*(k(i)*(x31(1)^2 + x31(2)^2) + 1) - x31(1)*(k(i)*(x3p1(1)^2 + x3p1(2)^2) + 1); ...
        %s(i)*(k(i)*(x41(1)^2 + x41(2)^2) + 1)*(k(i)*(x4p1(1)^2 + x4p1(2)^2) + 1) + l1(i)*s(i)*x4p1(1)*(k(i)*(x41(1)^2 + x41(2)^2) + 1) + l2(i)*s(i)*x4p1(2)*(k(i)*(x41(1)^2 + x41(2)^2) + 1),                                                               0, - s(i)*x41(1)*(k(i)*(x4p1(1)^2 + x4p1(2)^2) + 1) - l1(i)*s(i)*x41(1)*x4p1(1) - l2(i)*s(i)*x41(1)*x4p1(2), x4p1(1)*(k(i)*(x41(1)^2 + x41(2)^2) + 1) - x41(1)*(k(i)*(x4p1(1)^2 + x4p1(2)^2) + 1); ...
        l1(i),                                                              l2(i),                                                                 1,                                                            0];
    
    [~,~,U] = svd(M2);
    
    u1(i) = U(1,end)/U(4,end);
    u2(i) = U(2,end)/U(4,end);
    u3(i) = U(3,end)/U(4,end);
    
    
end


% Action =  x
% Quotient ring basis (V) = w^-1,y*w^-1,z*w^-1,z^2*w^-1,x*w^-1,x^2*w^-1,
% Available monomials (RR*V) = x*y*w^-1,x*z*w^-1,x*z^2*w^-1,x^3*w^-1,w^-1,y*w^-1,z*w^-1,z^2*w^-1,x*w^-1,x^2*w^-1,
function [coeffs,coeffs_ind] = compute_coeffs(data)
coeffs0 = compute_coefficients_H35lv1v2k_det_54x60(data);
coeffs = [coeffs0(325:424);-coeffs0(119:137);1;-coeffs0(138)];
coeffs_ind = [3,12,4,13,14,32,34,53,54,63,64,82,83,92,84,93,103,104,4,13,14,33,54,64,83,84,93,104,1,5,11,15,35,44,51,55,61,65,81,85,91,94,101,105,114,2,5,11,6,12,...
15,16,31,36,45,52,55,61,56,62,65,66,81,82,85,91,86,92,94,95,102,105,106,115,3,6,12,15,7,13,16,17,32,35,37,53,56,62,57,63,66,67,82,85,83,86,92,94,87,93,...
95,103,106,107,4,7,13,16,14,17,33,36,54,57,63,64,67,83,86,84,87,93,95,104,107,5,11,8,15,18,31,38,46,55,61,58,65,68,81,85,91,88,94,96,101,105,111,108,116,6,...
12,8,15,9,16,18,19,32,35,39,56,62,58,65,59,66,68,69,82,85,86,92,88,94,89,95,96,102,106,112,108,109,7,13,9,16,18,17,19,33,36,38,57,63,59,66,67,69,83,86,...
88,87,93,89,95,96,103,107,113,109,8,15,10,18,20,35,40,58,65,60,68,70,85,88,94,90,96,105,108,114,110,9,16,10,18,19,20,36,38,59,66,60,68,69,70,86,88,89,95,90,...
96,106,109,115,110,17,19,20,37,39,40,67,69,87,89,90,107,10,18,20,38,60,68,70,88,90,96,108,110,116,19,20,39,40,69,70,89,90,109,20,40,70,90,110,1,11,21,31,41,47,...
51,61,71,81,91,97,101,111,117,2,11,12,21,22,31,32,42,48,52,61,62,71,72,81,82,91,92,97,98,101,102,111,112,118,3,12,21,13,22,23,32,41,33,43,53,62,63,72,73,82,...
91,83,92,97,93,98,102,103,112,113,4,13,22,14,23,33,42,34,54,63,64,73,83,92,84,93,98,103,104,113,14,23,34,43,64,84,93,104,5,11,15,21,24,31,35,44,49,55,61,65,...
71,74,81,85,91,94,97,99,101,105,111,114,119,6,12,15,21,16,22,24,25,32,35,41,36,45,56,62,65,71,66,72,74,75,82,85,91,86,92,94,97,95,98,99,102,105,106,112,114,115,...
7,13,16,22,24,17,23,25,33,36,42,44,37,57,63,66,72,67,73,75,83,86,92,94,87,93,95,98,99,103,106,107,113,115,14,17,23,25,34,37,43,45,64,67,73,84,87,93,95,104,...
107,8,15,21,18,24,26,35,41,38,46,58,65,71,68,74,76,85,91,88,94,97,96,99,105,111,108,114,117,116,9,16,22,18,24,19,25,26,36,42,38,44,39,59,66,72,68,74,69,75,...
76,86,92,88,94,89,95,98,96,99,106,112,108,109,115,118,116,17,23,19,25,26,37,43,39,45,46,67,73,69,75,87,93,89,95,96,107,113,109,10,18,24,20,26,38,44,40,60,68,74,...
70,76,88,94,90,96,99,108,114,110,116,119,19,25,20,26,39,45,40,46,69,75,70,76,89,95,90,96,109,115,110,20,26,40,46,70,76,90,96,110,116,11,21,27,31,41,47,50,61,71,...
77,81,91,97,100,101,111,117,121,12,21,22,27,28,32,41,42,48,62,71,72,77,78,82,91,92,97,98,100,102,111,112,117,118,13,22,27,23,28,33,42,47,43,63,72,73,78,83,92,97,...
93,98,100,103,112,113,118,14,23,28,34,43,48,64,73,84,93,98,104,113,15,21,24,27,29,35,41,44,49,65,71,74,77,79,85,91,94,97,99,100,105,111,114,117,119,16,22,24,27,25,...
28,29,36,42,44,47,45,66,72,74,77,75,78,79,86,92,94,97,95,98,99,100,106,112,114,115,118,119,17,23,25,28,29,37,43,45,48,49,67,73,75,78,87,93,95,98,99,107,113,115,...
18,24,27,26,29,38,44,47,46,68,74,77,76,79,88,94,97,96,99,100,108,114,117,116,119,121,19,25,28,26,29,39,45,48,46,49,69,75,78,76,79,89,95,98,96,99,109,115,118,116,...
20,26,29,40,46,49,70,76,79,90,96,99,110,116,119,21,27,30,41,47,50,71,77,80,91,97,100,111,117,121,22,27,28,30,42,47,48,72,77,78,80,92,97,98,100,112,117,118,121,23,...
28,30,43,48,50,73,78,93,98,100,113,118,24,27,29,30,44,47,49,74,77,79,80,94,97,99,100,114,117,119,121,25,28,29,30,45,48,49,50,75,78,79,80,95,98,99,100,115,118,119,...
26,29,30,46,49,50,76,79,80,96,99,100,116,119,121,27,30,47,50,77,80,97,100,117,121,28,30,48,50,78,80,98,100,118,121,29,30,49,50,79,80,99,100,119,121,30,50,80,100,121,...
120,120,120,120,120,120,120,120,120,120];
function C = setup_elimination_template(data)
[coeffs,coeffs_ind] = compute_coeffs(data);
C_ind = [4,6,7,9,10,16,18,23,25,27,28,34,38,40,41,43,52,53,58,60,63,70,77,81,88,92,94,106,110,115,116,118,126,127,129,133,134,136,144,149,150,152,158,161,162,164,166,167,169,170,...
171,172,177,180,181,183,185,186,187,188,189,190,195,198,200,201,203,204,205,206,212,214,215,216,218,220,221,222,223,224,225,226,231,232,234,237,239,240,241,242,243,244,249,250,252,254,255,256,257,258,...
259,266,268,269,272,274,275,276,278,279,285,286,291,293,294,296,297,303,304,306,308,309,310,320,322,326,327,331,332,334,337,342,343,345,346,349,350,352,355,360,361,365,366,368,371,374,375,377,378,380,...
381,382,383,385,386,387,388,391,393,396,399,400,401,402,403,404,405,406,409,411,414,415,416,417,419,420,421,425,428,429,430,431,434,435,436,437,438,440,441,445,447,448,453,454,455,456,458,459,463,465,...
466,468,469,470,471,472,479,482,483,484,488,489,493,494,496,499,504,507,508,511,512,514,517,522,523,527,528,533,536,537,539,542,543,544,545,548,549,553,555,561,562,563,564,566,567,571,573,576,577,578,...
579,587,590,591,592,597,599,600,607,609,610,616,618,625,627,628,641,650,651,656,661,669,670,674,679,684,685,695,698,699,705,707,715,717,724,726,733,735,749,759,769,778,787,803,811,817,820,827,828,829,...
830,835,838,845,851,854,859,863,864,865,868,871,873,874,878,881,882,883,884,887,889,891,892,896,899,902,905,907,908,912,913,916,917,918,919,922,924,925,927,928,932,934,935,936,938,941,943,945,946,950,...
952,953,956,958,959,961,966,967,970,971,973,976,978,979,981,986,988,989,992,995,997,999,1004,1006,1007,1010,1012,1020,1021,1024,1030,1032,1040,1042,1049,1058,1060,1074,1081,1082,1087,1088,1090,1092,1097,1098,1099,1100,1101,1105,...
1106,1108,1110,1115,1116,1121,1122,1124,1126,1129,1130,1133,1134,1135,1136,1138,1139,1141,1142,1143,1144,1146,1148,1149,1151,1152,1154,1155,1157,1158,1159,1160,1161,1162,1164,1166,1167,1169,1170,1172,1173,1175,1176,1177,1180,1182,1183,1184,1186,1187,...
1189,1190,1192,1193,1194,1195,1196,1197,1200,1202,1203,1204,1205,1208,1209,1211,1212,1213,1214,1215,1218,1220,1221,1222,1223,1224,1226,1227,1228,1234,1236,1237,1238,1240,1244,1246,1247,1248,1254,1256,1257,1258,1263,1265,1266,1272,1274,1275,1276,1288,...
1290,1297,1298,1299,1303,1304,1306,1308,1309,1313,1314,1316,1317,1318,1321,1322,1324,1326,1327,1331,1332,1333,1337,1338,1342,1343,1345,1346,1347,1349,1351,1352,1353,1354,1355,1357,1358,1359,1362,1363,1364,1365,1367,1370,1371,1372,1373,1374,1375,1376,...
1377,1380,1381,1382,1383,1385,1386,1387,1388,1389,1396,1397,1398,1399,1400,1401,1402,1406,1407,1408,1409,1410,1416,1417,1418,1419,1420,1425,1426,1427,1428,1434,1435,1436,1437,1438,1450,1451,1452,1459,1460,1461,1465,1466,1470,1471,1475,1478,1479,1480,...
1483,1484,1488,1489,1493,1494,1495,1504,1505,1507,1508,1509,1514,1515,1516,1517,1524,1525,1526,1527,1533,1534,1535,1536,1542,1543,1544,1545,1558,1559,1560,1568,1569,1578,1579,1587,1588,1596,1597,1612,1613,1621,1627,1630,1631,1637,1638,1639,1640,1645,...
1648,1649,1655,1661,1664,1665,1669,1673,1674,1675,1678,1681,1683,1684,1685,1688,1691,1692,1694,1697,1699,1701,1702,1703,1706,1709,1712,1715,1717,1719,1722,1723,1726,1727,1729,1732,1734,1735,1737,1739,1742,1744,1745,1748,1751,1753,1755,1757,1760,1762,...
1763,1766,1768,1773,1776,1777,1780,1783,1786,1788,1793,1796,1798,1802,1805,1811,1814,1816,1827,1830,1837,1838,1843,1844,1846,1847,1848,1853,1854,1856,1857,1861,1862,1864,1865,1866,1871,1872,1877,1878,1881,1882,1885,1886,1889,1891,1892,1894,1895,1897,...
1898,1899,1901,1902,1904,1905,1907,1910,1911,1913,1914,1915,1916,1917,1919,1920,1922,1923,1925,1926,1928,1929,1935,1936,1938,1939,1940,1942,1945,1946,1948,1949,1950,1955,1956,1958,1959,1960,1964,1965,1967,1968,1973,1974,1976,1977,1978,1989,1990,1992,...
1999,2000,2001,2005,2006,2009,2010,2011,2015,2018,2019,2020,2023,2024,2027,2028,2029,2033,2034,2035,2043,2044,2045,2047,2048,2049,2053,2054,2055,2056,2057,2063,2064,2065,2066,2067,2072,2073,2074,2075,2076,2081,2082,2083,2084,2085,2097,2098,2099,2100,...
2107,2108,2109,2117,2118,2119,2126,2127,2128,2135,2136,2137,2151,2152,2153,2161,2167,2170,2171,2177,2178,2180,2185,2188,2189,2195,2201,2205,2209,2213,2215,2218,2221,2223,2225,2228,2231,2234,2237,2239,2241,2243,2246,2249,2252,2259,2262,2263,2266,2269,...
2272,2274,2279,2282,2284,2288,2291,2297,2300,2302,2313,2316,2323,2324,2329,2330,2333,2334,2339,2342,2343,2347,2348,2351,2352,2357,2358,2367,2368,2371,2372,2377,2378,2380,2381,2387,2388,2390,2391,2396,2397,2399,2400,2405,2406,2408,2409,2421,2422,2424,...
2431,2432,2433,2441,2442,2443,2450,2451,2452,2459,2460,2461,2475,2476,2477,2485,2491,2495,2501,2504,2509,2513,2519,2529,2533,2539,2542,2549,2552,2558,2561,2567,2570,2583,2586,2593,2594,2603,2604,2612,2613,2621,2622,2637,2638,2647,2657,2666,2675,2691,...
2752,2804,2859,2916,2961,3018,3070,3125,3181,3239];
C = zeros(54,60);
C(C_ind) = coeffs(coeffs_ind);

