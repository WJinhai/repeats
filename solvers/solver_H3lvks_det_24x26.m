function [s, v1, v2, v3, l1, l2, k]  = solver_H3lvks_det_24x26(x1,xp1,x2,xp2,x3,xp3)
data = [x1(1:2);xp1(1:2);x2(1:2);xp2(1:2);x3(1:2);xp3(1:2)];
C = setup_elimination_template(data);
% C0 = C(:,1:24);
% C1 = C(:,25:26);
% C1 = C0\C1;
C = gj(C);
RR = [-C(22:24,25:26);eye(2)];
AM_ind = [1,2];
AM = RR(AM_ind,:);
[V,D] = eig(AM);
V = V ./ (ones(size(V,1),1)*V(1,:));
sols(1,:) = diag(D).';
sols(2,:) = RR(3,:)*V;
sols(3,:) = V(2,:);

l1 = sols(1,:);
l2 = sols(2,:);
k = sols(3,:);

x11 = x1;
x1p1 = xp1;

x21 = x2;
x2p1 = xp2;


x31 = x3;
x3p1 = xp3;





for i = 1:size(l1,2)
        
        M1 =  [                                                           - x11(2)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) - l1(i)*x11(2)*x1p1(1) - l2(i)*x11(2)*x1p1(2), x11(1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) + l1(i)*x11(1)*x1p1(1) + l2(i)*x11(1)*x1p1(2),                                                           0,                                          x11(1)*x1p1(2) - x11(2)*x1p1(1); ...
            - x21(2)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) - l1(i)*x21(2)*x2p1(1) - l2(i)*x21(2)*x2p1(2), x21(1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) + l1(i)*x21(1)*x2p1(1) + l2(i)*x21(1)*x2p1(2),                                                           0,                                          x21(1)*x2p1(2) - x21(2)*x2p1(1) ; ...
            (k(i)*(x11(1)^2 + x11(2)^2) + 1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) + l1(i)*x1p1(1)*(k(i)*(x11(1)^2 + x11(2)^2) + 1) + l2(i)*x1p1(2)*(k(i)*(x11(1)^2 + x11(2)^2) + 1),                                                         0, - x11(1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) - l1(i)*x11(1)*x1p1(1) - l2(i)*x11(1)*x1p1(2), x1p1(1)*(k(i)*(x11(1)^2 + x11(2)^2) + 1) - x11(1)*(k(i)*(x1p1(1)^2 + x1p1(2)^2) + 1) ; ...
            (k(i)*(x21(1)^2 + x21(2)^2) + 1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) + l1(i)*x2p1(1)*(k(i)*(x21(1)^2 + x21(2)^2) + 1) + l2(i)*x2p1(2)*(k(i)*(x21(1)^2 + x21(2)^2) + 1),                                                         0, - x21(1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) - l1(i)*x21(1)*x2p1(1) - l2(i)*x21(1)*x2p1(2), x2p1(1)*(k(i)*(x21(1)^2 + x21(2)^2) + 1) - x21(1)*(k(i)*(x2p1(1)^2 + x2p1(2)^2) + 1) ; ...
            l1(i),                                                        l2(i),                                                           1,                                                            0 ];
        
        [~,~,V] = svd(M1);
        
        v1(i) = V(1,end)/V(4,end);
        v2(i) = V(2,end)/V(4,end);
        v3(i) = V(3,end)/V(4,end);
        
        s(i) = (-x31(1)*x3p1(2) + x31(2)*x3p1(1))/( - (k(i)*(x3p1(1)^2 + x3p1(2)^2) + 1)*(v1(i)*x31(2) - v2(i)*x31(1)) - x3p1(1)*(l1(i)*v1(i)*x31(2) - l1(i)*v2(i)*x31(1)) - x3p1(2)*(l2(i)*v1(i)*x31(2) - l2(i)*v2(i)*x31(1))); 
end


function [coeffs,coeffs_ind] = compute_coeffs(data)
coeffs0 = compute_coefficients_H3lvks_det_24x26(data);
coeffs = [-coeffs0(89:95);1;-coeffs0(96);coeffs0(422:753)];
coeffs_ind = [19,25,40,70,91,129,150,180,201,222,243,264,285,306,327,20,26,41,71,92,130,151,181,202,223,244,265,286,307,328,21,27,42,72,93,131,152,182,203,224,245,266,287,308,329,4,10,22,31,43,...
61,73,94,132,153,171,183,204,225,246,267,288,309,23,44,74,95,112,133,154,184,205,226,247,268,289,310,330,24,45,75,96,113,134,155,185,206,227,248,269,290,311,331,25,32,46,76,97,114,135,...
156,186,207,228,249,270,291,312,332,26,33,47,77,98,115,136,157,187,208,229,250,271,292,313,333,27,34,48,78,99,116,137,158,188,209,230,251,272,293,314,334,1,6,11,28,49,62,79,100,117,...
138,159,172,189,210,231,252,273,294,315,335,2,5,7,9,12,29,35,50,63,80,101,118,139,160,173,190,211,232,253,274,295,316,3,6,7,13,30,36,51,64,81,102,119,140,161,174,191,212,233,...
254,275,296,317,336,4,7,14,31,37,52,65,82,103,120,141,162,175,192,213,234,255,276,297,318,32,53,83,104,121,142,163,193,214,235,256,277,298,319,337,33,54,84,105,122,143,164,194,215,236,...
257,278,299,320,338,34,38,55,85,106,123,144,165,195,216,237,258,279,300,321,339,5,9,15,35,56,66,86,107,124,145,166,176,196,217,238,259,280,301,322,6,9,16,36,57,67,87,108,125,146,...
167,177,197,218,239,260,281,302,323,340,7,9,17,37,39,58,68,88,109,126,147,168,178,198,219,240,261,282,303,324,38,59,89,110,127,148,169,199,220,241,262,283,304,325,341,9,18,39,60,69,...
90,111,128,149,170,179,200,221,242,263,284,305,326,8,8,8,8,8];

function C = setup_elimination_template(data)
[coeffs,coeffs_ind] = compute_coeffs(data);
C_ind = [7,8,9,11,12,14,15,17,18,19,20,21,22,23,24,31,32,33,35,36,38,39,41,42,43,44,45,46,47,48,55,56,57,59,60,62,63,65,66,67,68,69,70,71,72,74,78,79,80,81,...
82,83,84,86,87,88,89,90,91,92,93,94,95,103,105,107,108,109,110,111,113,114,115,116,117,118,119,120,127,129,131,132,133,134,135,137,138,139,140,141,142,143,144,151,152,153,155,156,157,158,...
159,161,162,163,164,165,166,167,168,175,176,177,179,180,181,182,183,185,186,187,188,189,190,191,192,199,200,201,203,204,205,206,207,209,210,211,212,213,214,215,216,217,219,222,223,225,226,227,228,229,...
230,231,232,233,234,235,236,237,238,239,240,241,242,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,265,266,267,270,271,272,273,274,275,276,277,278,279,280,281,282,283,...
284,285,286,287,288,289,290,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,319,321,323,324,325,326,327,329,330,331,332,333,334,335,336,343,345,347,348,349,350,351,353,354,355,...
356,357,358,359,360,367,368,369,371,372,373,374,375,377,378,379,380,381,382,383,384,385,388,390,391,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,409,411,414,415,417,418,419,420,421,422,...
423,424,425,426,427,428,429,430,431,432,433,434,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,463,465,467,468,469,470,471,473,474,475,476,477,478,479,480,481,486,487,489,490,...
491,492,493,494,495,496,497,498,499,500,501,502,503,508,533,555,577,602];
C = zeros(24,26);
C(C_ind) = coeffs(coeffs_ind);

